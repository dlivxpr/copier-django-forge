# 重定向 /{{project_slug}} → /{{project_slug}}/
location = /{{project_slug}} {
    return 301 $scheme://$http_host/{{project_slug}}/;
}

# 转发 /{{project_slug}}/ 到{{project_slug}}二级Nginx（去掉前缀，避免内部路径冲突）
location /{{project_slug}}/ {
    proxy_pass http://{{project_slug}}-nginx:80/;
    # 传递客户端信息，确保Django正确识别请求
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Port $server_port;  # 传递端口
}
